<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:AirsoftBmsApp.View.ContentViews.Inputs"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:mct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="AirsoftBmsApp.View.ContentViews.Inputs.ValidatableNumberEntry"
             x:Name="ValidatableEntry"
             >
    <VerticalStackLayout
        BindingContext="{Binding Source={RelativeSource AncestorType={x:Type local:ValidatableNumberEntry}}}"
     >
        <Border 

             Stroke="{toolkit:AppThemeResource Outline}"
             StrokeShape="RoundRectangle 45"
             Padding="20, 0">
            <Border.Triggers>
                <DataTrigger
                     TargetType="Border"
                     Binding="{Binding ValidatableObject.IsValid}"
                     Value="False"
                 >
                    <Setter Property="Stroke" Value="{toolkit:AppThemeResource Error}" />
                </DataTrigger>
            </Border.Triggers>
            <Entry 
                 x:Name="NumberEntry"
                 Placeholder="{Binding Placeholder}"
                 Text="{Binding ValidatableObject.Value, Mode=TwoWay}"
                 IsPassword="{Binding IsPassword}"
                 PlaceholderColor="{toolkit:AppThemeResource Outline}"
                 FontFamily="{StaticResource GlobalFont}" 
                 FontSize="15"
                 TextChanged="OnTextChanged"
                 BackgroundColor="Transparent" >
                <Entry.Behaviors >
                    <mct:EventToCommandBehavior 
                     EventName="TextChanged"
                     BindingContext="{Binding Path=BindingContext, Source={x:Reference ValidatableEntry}}"
                     Command="{Binding ValidateCommand, Source={x:Reference ValidatableEntry}}"
                     />
                </Entry.Behaviors>
            </Entry>

        </Border>
        <Label
             Text="{Binding ValidatableObject.Errors, Converter={StaticResource FirstValidationErrorConverter}}"
             TextColor="{toolkit:AppThemeResource Error}"
             FontFamily="{StaticResource GlobalFont}" 
             FontSize="10"
             IsVisible="{Binding ValidatableObject.IsValid, Converter={StaticResource InverseBoolConverter}}"
             HeightRequest="0"
             Margin="0"
             >
            <Label.Triggers>
                <DataTrigger
                     TargetType="Label"
                     Binding="{Binding ValidatableObject.IsValid}"
                     Value="false"
                     >
                    <Setter Property="HeightRequest" Value="-1" />
                    <Setter Property="Margin" Value="20,2,0,0" />
                </DataTrigger>
            </Label.Triggers>
        </Label>
    </VerticalStackLayout>
</ContentView>
